extends layout

block scripts


	script(src="/javascripts/leaflet.js")
	script(src="/javascripts/chroma.min.js")
	link(rel='stylesheet', href='/jquery-ui.css')
	link(href='https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css')
	script(src="/javascripts/leaflet.awesome-markers.min.js")
	link(rel='stylesheet', href='/stylesheets/leaflet.awesome-markers.css')
	script(src="/javascripts/map.public.js")
	script(src='//code.jquery.com/jquery-1.10.2.js')
	script(src='/jquery-ui.js')
	script(src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js')
	link(href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css' rel='stylesheet')
	link(href='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css' rel='stylesheet')
	link(rel='stylesheet', href='/stylesheets/style.css')
	//link(rel='stylesheet', href='/jquery-ui.css')


block icon
	li(class="uk-navbar-nav"): a()
		.search
			form(action='<?php echo home_url(); ?>', name='SearchForm', method='get')
				input#SearchForm(type='text', name='s', maxlength='64', placeholder='Search')
				.srch_btn(onclick='SearchForm.submit()')
					i.fa.fa-search

block map

	div(class="uk-grid uk-grid-small" id="themap")
		div(class="uk-width-4-4") 
			#map()
	div(id="ward_info" style="background-color:#FFA333;display:none;color:white")
		ul(class="uk-navbar-nav close_button" style="color:white;position:absolute;top:2%;right:0%" )
			li(class="uk-navbar-nav").fa.fa-close.fa-lg &nbsp
		h3(style="color:white")
			b &nbsp &nbsp
				span(id="sidebar-data-name") Ward #
		hr(style="size:1px;height:1px;width:100%;color:white;border-color:white;background-color:white;")
	
		div(style="width:60%;float:left;color:white")
			dl.warddl
				dt &nbsp &nbsp Area
				dt &nbsp
				dt &nbsp &nbsp Population
				dt &nbsp
				dt &nbsp &nbsp Population Density
				dt &nbsp
				dt &nbsp &nbsp Female Population
				dt &nbsp
				dt &nbsp &nbsp Male Population
				dt &nbsp
				dt &nbsp &nbsp Guidance Value
				dt &nbsp &nbsp &nbsp
					i (Approx)
				dt &nbsp
				dt &nbsp &nbsp Averages
				dt &nbsp &nbsp
				dt &nbsp &nbsp Market Value:
				dt &nbsp
				dt &nbsp &nbsp Listing Value:
				dt &nbsp
				dt &nbsp &nbsp Registration Value:

			dl
		div(style="width:40%;float:left;color:white")
			dl.warddl
				dt &nbsp &nbsp
					span(id="sidebar-data-area") 123
				dt &nbsp
				dt &nbsp &nbsp
					span(id="sidebar-data-pop") 456
				dt &nbsp
				dt &nbsp &nbsp
					span(id="sidebar-data-dens") 789
				dt &nbsp
				dt &nbsp &nbsp
					span(id="sidebar-data-pop-f") 101
				dt &nbsp
				dt &nbsp &nbsp
					span(id="sidebar-data-pop-m") 112
				dt &nbsp
				dt &nbsp &nbsp 
				dt &nbsp &nbsp
					span(id="sidebar-data-gv") 131
				dt &nbsp
				dt &nbsp &nbsp 
				dt &nbsp &nbsp
				dt &nbsp &nbsp
					span(id="sidebar-data-mv") 415
				dt &nbsp
				dt &nbsp &nbsp
					span(id="sidebar-data-lv") 161
				dt &nbsp
				dt &nbsp &nbsp
					span(id="sidebar-data-rv") 718
			dl
		hr(style="size:1px;height:1px;width:100%;color:white;border-color:white;background-color:white;")

	div( id="stack" style="display:none;background-color:#303030")
		div(id="title_pop" style="display:none;background-color:#303030")
			h4(style="color:darkorange;float:left;padding:0;margin:0")
				b Apartment #
			ul(class="uk-navbar-nav " style="color:darkorange;float:right" )
				li(class="uk-navbar-nav plus_pop")
					input(type='checkbox' style="color:darkorange").fa.fa-angle-down.fa-lg
				li(class="uk-navbar-nav close_button_pop" style="color:darkorange").fa.fa-times &nbsp

		div(id="box_pop" style="color:darkorange;display:none;background-color:#303030")
			h4(style="color:darkorange;float:left;padding:0;margin:0")
				b Apartment #
			ul(class="uk-navbar-nav " style="color:darkorange;float:right" )
				li(class="uk-navbar-nav minus_pop")
					input(type='checkbox' style="color:darkorange").fa.fa-angle-up.fa-lg
				li(class="uk-navbar-nav close_button_pop" style="color:darkorange").fa.fa-times &nbsp
			h5(style="color:darkorange")
				b Address
			p Second to the right and straight on till morning
			hr(style="size:1px;width:100%;color:white;border-color:white;background-color:white;")

			div(style="width:60%;float:left;color:white")
				dl

					dt &nbsp &nbsp Guidance Value
					dt &nbsp
					dt &nbsp &nbsp Market Value:
					dt &nbsp
					dt &nbsp &nbsp Listing Value:
					dt &nbsp
					dt &nbsp &nbsp Registration Value:

				dl
			div(style="width:40%;float:left;color:white")
				dl
					dt &nbsp &nbsp 123
					dt &nbsp
					dt &nbsp &nbsp 415
					dt &nbsp
					dt &nbsp &nbsp 161
					dt &nbsp
					dt &nbsp &nbsp 718
				dl
			hr(style="size:1px;width:100%;color:white;border-color:white;background-color:white;")
			a(href="/chart" class="chartlink" style="color:white" onClick="return popup(this, 'chart')")
				i See graph

	div( id="footer1" style="float:bottom;display:none;")
		label
			input(type='checkbox' )
			| Guidance Value
		&nbsp
		label
			input(type='checkbox' )
			| Market Value
		&nbsp
		label
			input(type='checkbox' )
			| Listing Value
		&nbsp 
		label
			input(type='checkbox' )
			| Registration Value
		&nbsp &nbsp &nbsp &nbsp
		| Maximum &nbsp
		input(placeholder='1000')
		&nbsp
		| Minimum &nbsp
		input(placeholder='4000')
		<hr>

	div( id="footer2" style="float:bottom;display:none;")
		label
			input(type='checkbox'  ).fa.fa-graduation-cap
			| &nbsp Schools
		&nbsp 
		label
			input(type='checkbox'  ).fa.fa-bus
			| &nbsp Major Bus Stands
		&nbsp 
		label
			input(type='checkbox'  ).fa.fa-subway
			| &nbsp Metro Stations
		&nbsp
		label 
			input(type='checkbox'  ).fa.fa-laptop
			| &nbsp IT Parks
		&nbsp

		<hr>
		
	div( id="footer3" style="float:bottom;display:none;")
		label
			input(type='checkbox'  class='check_box' id='check_box_Ward')
			| Wards
		&nbsp
		label 
			input(type='checkbox'  class='check_box' id='check_box_DRO')
			| DRO
		&nbsp
		label
			input(type='checkbox'  class='check_box' id='check_box_SRO')
			| SRO
		&nbsp
		<hr>

	

	div( id="footer" style="float:bottom")
		
		input#check1(type='checkbox' name='ward')
		label(for='check1') District
		&nbsp &nbsp
		input#check2(type='checkbox' name='amenity')
		label(for='check2') Amenity
		&nbsp &nbsp
		input#check3(type='checkbox' class='check_box' name='price')
		label(for='check3') Apartments


	script.
		// store layers in object to toggle later
		var map = init(!{attributes});

		function popup(mylink, windowname) {
			if (!window.focus)return true;
			var href;
			if (typeof(mylink) == 'string')
				href = mylink;
			else
				href = mylink.href;
			window.open(href, windowname, 'width=680,height=450,left=450,top=200,resizable=yes,location=no,');
			return false;
		}
		$(function() {
			$( "#check1" ).button();
			$( "#check2" ).button();
			$( "#check3" ).button();
		});
		$('#check_box_Ward').click(function(w){
			$('#check_box_SRO').removeAttr('checked');
			$('#check_box_DRO').removeAttr('checked');

		})
		$('#check_box_SRO').click(function(w){
			$('#check_box_Ward').removeAttr('checked');
			$('#check_box_DRO').removeAttr('checked');

		})
		$('#check_box_DRO').click(function(w){
			$('#check_box_SRO').removeAttr('checked');
			$('#check_box_Ward').removeAttr('checked');

		})
		$('.check_box').change(function(a){

			var layerCheckBox = function (layer){
				return ({
					check_box_Ward: 'Ward',
					check_box_SRO: 'SRO',
					check_box_DRO: 'DRO',
					check3: 'Apartments'
				}[layer]);
			}

			if ($('#'+a.target.id).attr('checked') != 'checked') {
				var id = a.target.id;
				$('#'+id).attr('checked',true)
				//add the layer
				addFeatureLayer(layerCheckBox(id));

			}else{
				var id = a.target.id;
				$('#'+id).attr('checked',false)
				//remove the layer

				removeFeatureLayer(layerCheckBox(id))
			}
		});

		$(document).ready(function () {
			$("input[name='price']").click(function() {
				$("#footer1").toggle();
			});
			$("input[name='amenity']").click(function() {
				$("#footer2").toggle();
			});
			$("input[name='ward']").click(function() {
				$("#footer3").toggle();
			});
			$(".close_button").click(function() {
				$("#ward_info").hide();
			});
			$(".close_button_pop").click(function() {
				$("#stack").hide();
			});
			$(".minus_pop").click(function() {
				$("#box_pop").hide();
				$("#title_pop").show();

			});
			$(".plus_pop").click(function() {
				$("#box_pop").show();
				$("#title_pop").hide();
				$testmarker.fire('click');

			});
			map.on('zoomend', function () {
				if (map.getZoom() > 13 && map.getZoom() < 15) {
					$("#ward_info").show();
				}
				if (map.getZoom() <= 13 || map.getZoom() >= 15)
				{
					$("#ward_info").hide();
				}
			});
			map.on('popupopen', function(evt) {
				var currentPopup =   evt.popup;
				$('.close_popup').click(function(e){

					if (currentPopup != null)currentPopup._source.closePopup();
				});
				$('.popout').click(function(e){
					if (currentPopup != null)currentPopup._source.closePopup();
					$("#stack").show();
					$("#box_pop").show();
				});
			});
			$(window).on("resize", function () {
			$("#map").height($(window).height() / 1.25).width($('#themap').width());
			map.invalidateSize();
			}).trigger("resize");


		});
